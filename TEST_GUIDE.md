# Minecraft Shop Lands プラグイン - テストガイド

## テスト環境の準備

1. **必要なプラグイン**
   - WorldGuard 7.0.12+
   - Paper/Spigot 1.21+

2. **プラグインのインストール**
   ```
   target/minecraft-shop-lands-1.0.jar を plugins フォルダにコピー
   ```

## 基本機能テスト

### 1. 範囲選択テスト
1. 木の斧を持つ
2. ブロックを左クリック（1つ目の座標）
3. 別のブロックを右クリック（2つ目の座標）
4. チャットに選択メッセージが表示されることを確認

### 2. 土地作成テスト
1. 範囲選択後、`/createshop` コマンドを実行
2. 以下が表示されることを確認：
   - 選択範囲の座標
   - 土地作成成功メッセージ
   - 看板アイテム配布メッセージ
3. インベントリに看板アイテムが追加されることを確認
4. WorldGuard地域が作成されることを確認 (`/rg info shop_プレイヤー名_タイムスタンプ`)
5. 看板アイテムを適切な場所に設置

### 3. 看板設置・置き換えテスト
1. **看板の手動設置**
   - 配布された看板アイテムを適切な場所に設置
   - 設置時に編集画面が表示されないことを確認
   - 看板が自動的に破壊・再設置されることを確認
   - 正しいテキストが設定されることを確認：
     ```
     [土地販売]
     土地名
     右クリックで
     土地を購入
     ```
2. **看板の保護機能**
   - 設置された看板を編集しようとする → 編集がキャンセルされる
   - 一般プレイヤーが看板を破壊しようとする → 破壊がキャンセルされる
   - 管理者権限で看板を破壊 → 破壊成功、データから削除される

### 4. 看板購入機能テスト
1. **初回購入テスト**
   - 設置された看板を右クリック
   - 以下を確認：
     - 看板が消える
     - 土地購入成功メッセージ
     - プレイヤーが地域のオーナーに追加される
   - 地域内で建築・破壊が可能になることを確認

2. **一アカウント一土地制限テスト**
   - 既に土地を所有しているプレイヤーで別の看板をクリック
   - 「既に土地を所有しています」メッセージが表示されることを確認
   - 購入がキャンセルされることを確認

3. **権限確認テスト**
   - 購入後、地域内での建築・破壊権限を確認
   - `/landinfo` コマンドで所有土地を確認

### 5. 権限テスト
1. **土地作成権限テスト**
   - `shoplands.create` 権限のないプレイヤーで `/createshop` コマンドを実行
   - 権限不足メッセージが表示されることを確認
2. **土地購入権限テスト**
   - `shoplands.buy` 権限のないプレイヤーで看板をクリック
   - 権限不足メッセージが表示されることを確認
3. **看板設置権限テスト**
   - 権限のないプレイヤーがショップ看板アイテムを設置しようとする
   - 設置がキャンセルされることを確認
4. **管理者権限テスト**
   - `shoplands.admin` 権限で看板破壊が可能であることを確認
   - `/resetland` コマンドが実行可能であることを確認

### 6. 土地情報・管理コマンドテスト
1. **土地情報確認テスト**
   - `/landinfo` コマンドを実行
   - 所有している土地のリストが表示されることを確認
   - 土地を所有していない場合は適切なメッセージが表示されることを確認

2. **土地リセット機能テスト**
   - 管理者権限で `/resetland <プレイヤー名>` を実行
   - 指定プレイヤーの土地所有権が削除されることを確認
   - 対象プレイヤーにリセット通知が送信されることを確認
   - 削除後、そのプレイヤーが新しい土地を購入できることを確認

### 7. 土地名変更テスト
1. 土地を作成後、`/renameland <古い名前> <新しい名前>` コマンドを実行
2. 以下を確認：
   - 土地名変更成功メッセージ
   - WorldGuard地域名の変更
   - 関連する看板のテキスト更新
3. 無効な土地名や存在しない土地名での実行時のエラーメッセージを確認

### 8. 建築権限問題のデバッグテスト
1. **購入した土地でブロックが置けない場合のデバッグ手順**
   - 土地を購入後、`/debugregion <地域名>` を実行
   - 以下の情報を確認：
     - 自分がオーナーになっているか
     - 地域の優先度が10に設定されているか
     - WorldGuardフラグの状態
   - デバッグメッセージで地域権限の保存が完了しているか確認

2. **建築権限のテスト手順**
   - 購入した土地内でブロックを設置・破壊してみる
   - 土地の境界線上で権限が正しく機能するか確認
   - 他のプレイヤーが購入していない土地で建築できないことを確認

3. **WorldGuard設定の確認**
   - `/rg info <地域名>` でWorldGuard地域情報を確認
   - オーナーが正しく設定されているか確認
   - 優先度や境界が正しく設定されているか確認

## トラブルシューティング

### 看板設置の問題
- **看板が自動設置されない場合**
  - コンソールログを確認
  - 選択範囲に十分な空間があるか確認
  - プレイヤーに建築権限があるか確認
- **看板の編集画面が表示される場合**
  - プラグインの遅延処理が正常に動作しているか確認
  - サーバーの負荷状況を確認

### WorldGuard連携が動作しない場合
- WorldGuardが正常にロードされているか確認
- サーバーログでエラーを確認
- WorldGuard APIのバージョン互換性を確認

### 看板の置き換えが失敗する場合
- ブロック設置権限を確認
- 看板設置場所の制限を確認
- プラグインのデバッグログを有効化

## 期待される動作

✅ 木の斧での範囲選択
✅ コマンドでの土地作成
✅ WorldGuard地域の自動作成（優先度10、フラグDENY）
✅ 看板アイテムの配布
✅ 手動看板設置と自動置き換え
✅ 看板の編集画面回避
✅ 看板クリックでの土地購入
✅ 購入者への建築権限付与（オーナー権限）
✅ 一アカウント一土地制限
✅ 土地名の変更機能
✅ 看板の自動更新機能
✅ 看板の保護機能（編集・破壊防止）
✅ 管理者による看板管理機能
✅ 土地情報確認機能
✅ 管理者による土地リセット機能

## ログ確認ポイント

- プラグイン有効化時: "MinecraftShopLands プラグインが有効になりました！"
- 範囲選択時: 座標選択メッセージ
- 土地作成時: 選択範囲と看板アイテム配布の表示
- 看板設置時: 看板置き換え処理と設置成功メッセージ
- 看板破壊・再設置時: 遅延処理の実行ログ
- 土地名変更時: 変更成功メッセージと看板更新状況
- 看板保護時: 編集・破壊キャンセルメッセージ
- エラー時: 詳細なエラーメッセージとスタックトレース

## 新機能の検証

### 看板置き換えシステム
1. 看板アイテムを設置
2. 自動的に看板が破壊・再設置される（3ティック後）
3. 正しいテキストが設定される
4. 編集画面が表示されない
5. autoSettingSigns リストから正常に削除される

### 看板保護システム
1. 設置済み看板の編集試行 → キャンセル
2. 一般ユーザーによる破壊試行 → キャンセル
3. 管理者による破壊 → 成功、データ削除
